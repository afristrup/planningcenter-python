# Planning Center MCP Server

A Model Context Protocol (MCP) server that provides read-only access to Planning Center APIs using [FastAPI-MCP](https://github.com/tadata-org/fastapi_mcp). This server exposes Planning Center data through FastAPI endpoints that are automatically converted to MCP tools, allowing AI assistants to interact with your Planning Center data safely.

## Features

- **FastAPI-native**: Built using FastAPI-MCP for seamless integration
- **Read-only operations**: All endpoints are designed for data retrieval only, ensuring data safety
- **Multiple Planning Center products**: Support for People, Services, and Registrations
- **Flexible authentication**: Supports both OAuth tokens and app ID/secret authentication
- **Comprehensive filtering**: Advanced filtering options for all endpoints
- **Pagination support**: Built-in pagination for large datasets
- **Auto-generated MCP tools**: FastAPI endpoints are automatically converted to MCP tools
- **Swagger documentation**: Full API documentation available at `/docs`

## Available Endpoints

The server provides these FastAPI endpoints that are automatically converted to MCP tools:

### People Management
- `POST /get_people` - Retrieve people with optional filtering (search, status, email, phone)
- `POST /get_person` - Get detailed information about a specific person

### Services Management
- `POST /get_services` - Retrieve all services
- `POST /get_service` - Get detailed information about a specific service
- `POST /get_plans` - Retrieve plans, optionally filtered by service
- `POST /get_plan` - Get detailed information about a specific plan

### Registrations Management
- `POST /get_registrations` - Retrieve registrations with optional status filtering
- `POST /get_registration` - Get detailed information about a specific registration
- `POST /get_attendees` - Retrieve attendees with optional filtering
- `POST /get_attendee` - Get detailed information about a specific attendee

### MCP Integration
- `GET /mcp` - MCP server endpoint (automatically generated by FastAPI-MCP)
- `GET /docs` - Swagger UI documentation
- `GET /openapi.json` - OpenAPI specification

## Installation

1. Clone or download this repository
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Configuration

### Environment Variables

Copy `env.example` to `.env` and configure your Planning Center API credentials:

```bash
cp env.example .env
```

Edit `.env` with your credentials:

```env
# Option 1: OAuth Access Token (recommended)
PCO_ACCESS_TOKEN=your_access_token_here

# Option 2: Application ID and Secret
# PCO_APP_ID=your_app_id_here
# PCO_SECRET=your_secret_here
```

### Authentication Methods

#### OAuth Access Token (Recommended)
1. Go to your Planning Center account settings
2. Navigate to "API Access" or "Personal Access Tokens"
3. Create a new token with appropriate permissions
4. Set the `PCO_ACCESS_TOKEN` environment variable

#### Application ID and Secret
1. Create a new application in Planning Center
2. Note the Application ID and Secret
3. Set both `PCO_APP_ID` and `PCO_SECRET` environment variables

## Usage

### Running the Server

```bash
python main.py
```

The server will start and display available tools and their descriptions.

### Using with MCP Clients

This server is designed to work with MCP-compatible clients. The FastAPI-MCP framework automatically converts your FastAPI endpoints to MCP tools. Configure your MCP client to connect to `http://localhost:8000/mcp`.

### Example API Usage

#### Get People
```bash
curl -X POST "http://localhost:8000/get_people" \
  -H "Content-Type: application/json" \
  -d '{
    "per_page": 10,
    "search": "john",
    "status": "active"
  }'
```

#### Get Plans for a Service
```bash
curl -X POST "http://localhost:8000/get_plans" \
  -H "Content-Type: application/json" \
  -d '{
    "service_id": "12345",
    "per_page": 25,
    "include": ["service", "plan_times"]
  }'
```

#### Get Attendees for an Event
```bash
curl -X POST "http://localhost:8000/get_attendees" \
  -H "Content-Type: application/json" \
  -d '{
    "event_id": "67890",
    "attendance_status": "checked_in",
    "per_page": 50
  }'
```

### Swagger Documentation

Visit `http://localhost:8000/docs` to see the interactive Swagger UI documentation for all endpoints.

## API Reference

### Common Parameters

- `per_page`: Number of items per page (default: 25, max: 100)
- `offset`: Offset for pagination (default: 0)
- `include`: List of related resources to include in the response

### People Tools

#### get_people
- `search`: Search query for people names or emails
- `status`: Filter by status ("active" or "inactive")
- `email`: Filter by specific email address
- `phone`: Filter by specific phone number

#### get_person
- `person_id`: ID of the person to retrieve
- `include`: Related resources to include

### Services Tools

#### get_services
- Standard pagination parameters

#### get_service
- `service_id`: ID of the service to retrieve
- `include`: Related resources to include

#### get_plans
- `service_id`: Filter plans by service ID
- Standard pagination parameters

#### get_plan
- `plan_id`: ID of the plan to retrieve
- `include`: Related resources to include

### Registrations Tools

#### get_registrations
- `status`: Filter by status ("open" or "closed")
- Standard pagination parameters

#### get_registration
- `registration_id`: ID of the registration to retrieve
- `include`: Related resources to include

#### get_attendees
- `event_id`: Filter by event ID
- `registration_instance_id`: Filter by registration instance ID
- `attendance_status`: Filter by attendance status ("checked_in" or "checked_out")
- Standard pagination parameters

#### get_attendee
- `attendee_id`: ID of the attendee to retrieve
- `include`: Related resources to include

## Error Handling

The server includes comprehensive error handling for:
- Authentication failures
- Invalid parameters
- API rate limiting
- Network connectivity issues
- Invalid resource IDs

## Security Considerations

- **Read-only access**: This server only provides read access to Planning Center data
- **Environment variables**: Credentials are loaded from environment variables, not hardcoded
- **Input validation**: All input parameters are validated before making API calls
- **Rate limiting**: Built-in respect for Planning Center API rate limits

## Development

### Project Structure

```
planning-center-mcp-server/
├── planning_center_mcp/
│   ├── __init__.py
│   ├── config.py          # Configuration management
│   ├── client.py          # Planning Center API client
│   ├── tools.py           # MCP tool definitions
│   └── server.py          # MCP server setup
├── main.py                # Entry point
├── requirements.txt       # Dependencies
├── pyproject.toml         # Project configuration
├── env.example           # Environment variables example
└── README.md             # This file
```

### Adding New Tools

1. Define request models in `tools.py`
2. Implement the tool handler function
3. Register the tool in the `create_tools()` function
4. Update this README with the new tool documentation

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## Support

For issues and questions:
1. Check the Planning Center API documentation
2. Verify your authentication credentials
3. Check the server logs for detailed error messages
4. Open an issue in this repository
